# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

# Repository
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

%packages
@^minimal-environment
@container-management
@^server-product-environment
moby-engine

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$GUR7JVrMMV2qEns03xqXDpxP$ebZKXQnGHSdjK7fGCpUJ4q9JWT2sOaxcecqGs8szy7/
user --groups=wheel --name=user --password=$y$j9T$pvRVcBQGOPrks.YCptOsu37l$IFmZyyle1DALZvWI7fYCAjibRXw2QPkxuJ.b7KF0oA8 --iscrypted

%post --erroronfail --log=/root/ks-post.log

# Add root to docker group and enable docker service
usermod -aG docker root
systemctl enable docker

# Create systemd service for docker container
cat << 'EOF' > /etc/systemd/system/takenote-docker.service
[Unit]
Description=docker download and run
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes

ExecStart=/usr/bin/docker pull natbal/takenotepipline
ExecStart=/usr/bin/docker run -t -d --name app -p 5000:5000 natbal/takenotepipline

[Install]
WantedBy=multi-user.target
EOF

# Reload systemd and enable the new service
systemctl daemon-reload
systemctl enable takenote-docker.service
systemctl start takenote-docker.service

%end

reboot