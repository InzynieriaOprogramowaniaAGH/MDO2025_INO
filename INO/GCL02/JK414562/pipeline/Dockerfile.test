FROM debian:bullseye
WORKDIR /app

RUN apt-get update \
 && apt-get install -y --no-install-recommends \
      build-essential \
      gettext \
      liblzma-dev \
      ca-certificates \
 && rm -rf /var/lib/apt/lists/*

# Kopiujemy spakowany tarball
COPY artifacts/xz.tar.gz ./

# Rozpakowujemy, budujemy i uruchamiamy testy
RUN tar xzf xz.tar.gz \
 && cd xz-* \
 && ./configure \
 && make -j"$(nproc)" check || true \
 \
# Zbieramy logi i scalamy w jeden plik test_results.log
 && mkdir -p /app/logs \
 && cp tests/*.log /app/logs/ \
 && cat /app/logs/*.log > /app/logs/test_results.log
