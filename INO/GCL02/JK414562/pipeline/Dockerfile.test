FROM debian:bullseye

RUN apt-get update && apt-get install -y --fix-missing \
    build-essential gettext autopoint libtool automake \
    autoconf pkg-config git make ca-certificates

WORKDIR /app
COPY xz/ /app/

# Uruchom testy autotools i złap logi
RUN ./autogen.sh && ./configure && make check || true

# Przygotuj katalog na logi i wrzuć rzeczywisty wynik
RUN mkdir -p /app/logs \
 && make -C . check > /app/logs/test_results.log 2>&1 || true

CMD ["bash"]
