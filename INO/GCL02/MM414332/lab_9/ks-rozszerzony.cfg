#version=DEVEL
# Generated by Anaconda 42.27.12

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'

# System language
lang pl_PL.UTF-8

# Network configuration
network --bootproto=dhcp --onboot=on --hostname=fedora-mat.local

# System timezone
timezone Europe/Warsaw --utc

# Root password and user
rootpw --lock
user --groups=wheel --name=mmatyja --password=$y$j9T$OebdYys6LMxk1dIHNHM1jFit$/AaQCPLjD8l5fVipJVenE8kss2m2fqHj8PuRR1iwFA3 --iscrypted --gecos="Mateusz Matyja"

# Disk partitioning
ignoredisk --only-use=sda
clearpart --all --initlabel
autopart

# Package selection
%packages
@^server-product-environment
git
gcc
make
autoconf
automake
libtool
wget
%end

# Setup agent
firstboot --disable

# Installation sources
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-42&arch=aarch64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f42&arch=aarch64

# Post-installation script
%post --log=/root/ks-post.log --interpreter=/bin/bash

# Klonowanie i budowanie projektu xz
mkdir -p /opt/xz
cd /opt/xz
git clone https://github.com/tukaani-project/xz.git
cd xz
./autogen.sh
./configure
make
make install

echo "Mateusz Matyja test" > /opt/test.txt

# Tworzenie skryptu uruchamiajÄ…cego XZ
cat << 'EOF' > /usr/local/bin/run-xz.sh
#!/bin/bash
xz -z -k /opt/test.txt
EOF

chmod +x /usr/local/bin/run-xz.sh

cat << 'EOF' > /etc/systemd/system/run-xz.service
[Unit]
Description=Run XZ compression test at boot
After=network-online.target

[Service]
ExecStart=/usr/local/bin/run-xz.sh
Type=oneshot
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF

systemctl enable run-xz.service

%end

reboot
