# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64
network --hostname=fedora-netinst-2

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

%packages
@^custom-environment
docker
wget
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all --initlabel

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$cAJf.pCdxJvjHY7SRrTOeA0t$t4psIzNQCdlN7NVNl6YKV0U/yzS0PIwKTskgWKh0OL6

%post
systemctl enable docker

echo -e '#!/bin/bash\nsleep 15\nwget http://192.168.100.40:8000/zlib-runtime-1.0.0.tar -O /tmp/zlib-runtime.tar\n\
docker load -i /tmp/zlib-runtime.tar\n\
docker rm -f zlib-app 2>/dev/null || true\n\
docker run -d --name zlib-app mybuilder-zlib-1.0.0 /bin/sh -c "/app/example64; sleep infinity"' > /usr/local/bin/start_zlib.sh

chmod +x /usr/local/bin/start_zlib.sh

cat <<EOF > /etc/systemd/system/zlib-app.service
[Unit]
Description=Start zlib docker container
After=network.target docker.service
Requires=docker.service

[Service]
Type=oneshot
ExecStart=/usr/local/bin/start_zlib.sh
RemainAfterExit=true

[Install]
WantedBy=multi-user.target
EOF

systemctl enable zlib-app.service
%end

