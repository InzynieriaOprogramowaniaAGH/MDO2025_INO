#version=DEVEL
# Generated by Anaconda 41.35
# Modified to install and run xz project from GitHub

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'

# System language
lang pl_PL.UTF-8

# Network configuration
network --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate
network --hostname=fedora-xz.local

# System timezone
timezone Europe/Warsaw --utc

# Root password and user
rootpw haslo123 --plaintext
user --groups=wheel --name=kasiam --password=haslo123 --plaintext --gecos="kasiam"

# Disk partitioning
ignoredisk --only-use=sda
autopart
clearpart --all --initlabel

# Package selection
%packages
@^server-product-environment
git
gcc
make
autoconf
automake
libtool
wget
%end

# Setup agent
firstboot --enable

# Installation sources
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

# Post-installation script
%post --log=/root/ks-post.log --interpreter=/bin/bash

# Klonowanie i budowanie projektu xz
mkdir -p /opt/xz
cd /opt/xz
git clone https://github.com/tukaani-project/xz.git
cd xz
./autogen.sh
./configure
make
make install

# Tworzenie testowego pliku do kompresji
echo "To jest testowy plik XZ" > /opt/test.txt

# Tworzenie skryptu uruchamiającego XZ
cat << 'EOF' > /usr/local/bin/run-xz.sh
#!/bin/bash
xz -z -k /opt/test.txt
EOF

chmod +x /usr/local/bin/run-xz.sh

# Tworzenie usługi systemd, która uruchomi xz przy starcie
cat << 'EOF' > /etc/systemd/system/run-xz.service
[Unit]
Description=Run XZ compression test at boot
After=network-online.target

[Service]
ExecStart=/usr/local/bin/run-xz.sh
Type=oneshot
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF

# Włącz usługę
systemctl enable run-xz.service

%end

# Reboot after installation
reboot

