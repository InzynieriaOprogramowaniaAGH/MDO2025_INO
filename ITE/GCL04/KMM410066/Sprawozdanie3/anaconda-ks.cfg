# Generated by Anaconda 42.27.12
# Generated by pykickstart v3.62
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-42&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f42&arch=x86_64

%packages
@^server-product-environment
dnf-plugins-core  # Required for adding repositories
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.12.1
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all

# System timezone
timezone Europe/Warsaw --utc

#Root password
rootpw --lock
user --groups=wheel --name=skaner --password=$y$j9T$MVc.bUmwOLIj57rkWeV.d04q$GAxM/912cT5T/uiJpk1UkAcDanADPI7z7Rw3w.G.ep8 --iscrypted --gecos="Krzysztof Majerczyk-Marchewka"

%post

hostnamectl set-hostname fedora-server
# Add Docker repository and install Docker
dnf config-manager addrepo --from-repofile="https://download.docker.com/linux/fedora/docker-ce.repo"
dnf install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# Enable and start Docker
systemctl enable --now docker

# Add user to docker group
usermod -aG docker skaner

# Create a systemd service to ensure the container runs on boot
cat > /etc/systemd/system/kagikachi.service <<EOF
[Unit]
Description=Kagikachi Container
After=docker.service
Requires=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm --name kagikachi -p 7878:7878 skanerooo/kagikachi:latest
ExecStop=/usr/bin/docker stop kagikachi

[Install]
WantedBy=multi-user.target
EOF

# Enable the container service
systemctl enable kagikachi.service

%end

reboot