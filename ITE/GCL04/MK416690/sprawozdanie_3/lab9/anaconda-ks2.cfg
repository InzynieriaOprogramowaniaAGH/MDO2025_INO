# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang pl_PL.UTF-8

repo --name=fedora --baseurl=http://download.fedoraproject.org/pub/fedora/linux/releases/41/Everything/x86_64/os/
repo --name=updates --baseurl=http://download.fedoraproject.org/pub/fedora/linux/updates/41/Everything/x86_64/

%packages
@^server-product-environment

wget
curl
docker

%end

# Run the Setup Agent on first boot
firstboot --enable
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all  --initlabel
autopart

# System timezone
timezone Europe/Warsaw --utc

network --hostname=rogal-ddl

# Root password
rootpw --iscrypted $y$j9T$b2DtvHN/QOO96Jm7qeNegaLP$T4zrpEVTg7itvAX6uYuf4/K3ytfS61TZ.4kba5SkUp5
user --groups=wheel --name=marek --password=$y$j9T$Cr2SxBjChaLJAPgF0FBDbMWz$TujpGXLkHO4DXhZ7N0/aaa2zmFfJgxB6Mgcq4ZecEX/ --iscrypted

%post --log=/root/post-install.log --interpreter=/bin/bash
systemctl enable --now docker
systemctl start docker

usermod -aG docker marek

docker pull mareczek02/devopsy:latest

cat <<EOF > /etc/systemd/system/cpmdeploy.service
[Unit]
Description=Vue Application Docker Container
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm -p 3000:3000 --name cpm_deploy mareczek02/devopsy
ExecStop=/usr/bin/docker stop cpm_deploy

[Install]
WantedBy=multi-user.target
EOF

systemctl enable cpmdeploy.service
firewall-cmd --permanent --add-port=3000/tcp
firewall-cmd --reload

%end

reboot