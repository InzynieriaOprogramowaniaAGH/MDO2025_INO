# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

%packages
@^custom-environment

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$sv/NneP/7bvCksr3Grj4eGYC$LKhLLz56YRopOiEtn2.E57I4y9cxBJ1bHs31sMo3mZ0
user --groups=wheel --name=user --password=$y$j9T$dEbPZxjAOm6DrXW0pHkYvc8i$9DB42o70wUkWqzoEfeYVrYlICxB7GiFUvJz7R3SatO9 --iscrypted --gecos="user"

# ISO url
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=aarch64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=aarch64

# Hostname
network --hostname=Fedora

# Post
%post

dnf -y install dnf-plugins-core
dnf config-manager --add-repo=https://download.docker.com/linux/fedora/docker-ce.repo

dnf install -y docker-ce docker-ce-cli containerd.io

systemctl enable docker

usermod -aG docker user

cat << 'EOF' > /etc/rc.d/rc.local
#!/bin/bash
/usr/bin/docker pull cumil/apache-basic:latest
/usr/bin/docker run -d --name apache_container -p 80:80 cumil/apache-basic:latest
EOF

chmod +x /etc/rc.d/rc.local

cat << 'EOF' > /etc/systemd/system/rc-local.service
[Unit]
Description=/etc/rc.d/rc.local Compatibility
ConditionPathExists=/etc/rc.d/rc.local
After=network.target docker.service
Requires=docker.service

[Service]
Type=forking
ExecStart=/etc/rc.d/rc.local
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
SysVStartPriority=99

[Install]
WantedBy=multi-user.target
EOF

systemctl enable rc-local

%end
