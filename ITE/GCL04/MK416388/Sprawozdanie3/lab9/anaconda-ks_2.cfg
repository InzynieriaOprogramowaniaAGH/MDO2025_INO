# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

repo --name=fedora --baseurl=http://download.fedoraproject.org/pub/fedora/linux/releases/41/Everything/x86_64/os/
repo --name=updates --baseurl=http://download.fedoraproject.org/pub/fedora/linux/updates/41/Everything/x86_64/

%packages
@^server-product-environment

%end

# Run the Setup Agent on first boot
firstboot --enable
skipx

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all  --initlabel
autopart

# System timezone
timezone Europe/Warsaw --utc

network --hostname=non-localhost
rootpw --iscrypted $y$j9T$crVz62v3kzp0Rp3iZuj8c6jt$nse1YNvMC5q.grehgHovKwGQnth8ZHgRt28lvwbhTGA
# User account
user --groups=wheel --name=mkrol --password=$y$j9T$7xQaOvhOAYJEexNAKS4wXH0d$EX6UnztKWwJUE7oQs4d9xZpdbzKwby8G1nbz1cYYj24 --iscrypted --gecos="Marcin Kr√≥l"


%post --log=/root/post-install.log --interpreter=/bin/bash

echo "Docker"
systemctl enable docker
systemctl start docker
usermod -aG docker marcin

echo "Deploy container"
docker pull pyonaaa/node-js-dummy-test:latest

cat <<EOF > /etc/systemd/system/node-js-dummy-test.service
[Unit]
Description=Node.js Application Container
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm -p 3000:3000 --name nodeapp pyonaaa/node-js-dummy-test:latest
ExecStop=/usr/bin/docker stop node-js-dummy-test

[Install]
WantedBy=multi-user.target
EOF

systemctl enable node-js-dummy-test.service
firewall-cmd --add-port=3000/tcp --permanent
firewall-cmd --reload

echo "deployment complete."
%end

reboot