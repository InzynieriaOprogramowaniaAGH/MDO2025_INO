#version=DEVEL


repo --name="fedora" --baseurl=https://download.fedoraproject.org/pub/fedora/linux/releases/41/Everything/x86_64/os/

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$vVs/x/BIvNTzdCNb/XPjlpi1$caolusBjQ.BUSIKXzN7shSyZtKcPlHpcPjmaLbZt4n7
user --groups=wheel --name=kolezynski --gecos="kolezynski"

ignoredisk --only-use=sda
autopart
clearpart --all --initlabel

firstboot --enable

%packages
@^server-product-environment
java-17-openjdk-headless
wget
%end

%post --log=/root/post-install.log
mkdir -p /usr/local/bin
curl -L -o /usr/local/bin/swiftcode-application.jar https://raw.githubusercontent.com/InzynieriaOprogramowaniaAGH/MDO2025_INO/MK415983/ITE/GCL04/MK415983/Sprawozdanie3/swiftcode-application.jar
chmod +x /usr/local/bin/swiftcode-application.jar

# Verify Java installation
alternatives --set java /usr/lib/jvm/jre-17-openjdk/bin/java

# Create systemd service with better configuration
cat > /etc/systemd/system/myapp.service << EOF
[Unit]
Description=Swiftcode App
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
ExecStart=java -jar /usr/local/bin/swiftcode-application.jar
WorkingDirectory=/usr/local/bin
User=root
Restart=always
RestartSec=5
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# Enable and start the service
systemctl daemon-reload
systemctl enable myapp.service
systemctl start myapp.service

# Verify service status (for debugging)
systemctl status myapp.service >> /root/post-install.log
journalctl -u myapp.service >> /root/post-install.log
%end
