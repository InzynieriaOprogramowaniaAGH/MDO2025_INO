# Generated by Anaconda 40.22.3
# Generated by pykickstart v3.52
#version=DEVEL
# Use graphical install
graphical

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-40&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f40&arch=x86_64

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

%packages
@^server-product-environment
@core
wget
tar
zstd
%end

%post --log=/root/post-install.log
set -e

mkdir -p /opt/myapp
cd /opt/myapp

# Pobranie .deb
wget --timeout=10 --tries=2 http://192.168.56.1:8000/wget.deb -O wget.deb

ar x wget.deb
tar -xf data.tar.* || echo "Nie udalo sie rozpakowac data.tar"

# Szukamy binarki i kopiujemy
find . -type f -name 'wget' -executable -exec cp {} /usr/local/bin/myapp \;
chmod +x /usr/local/bin/myapp

cat <<EOF > /etc/systemd/system/myapp.service
[Unit]
Description=My custom app
After=network.target

[Service]
ExecStart=/usr/local/bin/myapp --version
Type=oneshot
RemainAfterExit=yes
Restart=no

[Install]
WantedBy=multi-user.target
EOF

systemctl enable myapp
%end

firstboot --enable

# Generated using Blivet version 3.9.1
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all --initlabel

network --hostname=fedora-unattended

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$3ENGnB/ZtJrLAAHSCVo5iwlq$46iVnSs2dbU992wgrqk.BnJ/0Mgn5xKW0T0g7n0HoU3
user --groups=wheel --name=kickstart --password=$y$j9T$mCl6BCUxsWaW16WGxUxp8ukI$F8gsIf.mo3rFdOn4lZZiuHmPvZbz/tJL3ztg6uG2B41 --iscrypted --gecos="Kickstart"

reboot