# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Host name
network --hostname=pieczons-server

# System timezone
timezone Europe/Warsaw --utc

# Repozytoria
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang pl_PL.UTF-8

# Root password
rootpw --plaintext pieczon
user --groups=wheel --name=pieczon --password='$y$j9T$In7xVBKU2ihXdRgnf3jxs/$6tI.ELsqY.QLNRHvzFev6rr7HRv8Vmabc00kgaylNN1' --iscrypted


# Run the Setup Agent on first boot
# firstboot --enable
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
# System bootloader configuration
bootloader --location=mbr --boot-drive=sda
autopart
# Partition clearing information
clearpart --all

%packages
@^custom-environment
docker
git
tar
wget

%end


%post --nochroot
systemctl enable docker

sleep 10

/usr/bin/docker pull peczyn/nginx-custom:1.1

cat <<EOF > /mnt/sysimage/etc/systemd/system/nginx-container.service
[Unit]
Description=Custom NGINX Container
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm --name nginx-custom -p 80:80 peczyn/nginx-custom:1.1
ExecStop=/usr/bin/docker stop nginx-custom

[Install]
WantedBy=multi-user.target
EOF

# Włącz jednostkę w nowym systemie
chroot /mnt/sysimage /bin/systemctl enable nginx-container.service

%end


reboot