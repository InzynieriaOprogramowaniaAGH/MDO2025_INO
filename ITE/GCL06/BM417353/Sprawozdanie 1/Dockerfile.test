# Dockerfile.test
FROM irssi-builder AS tester

# Instalacja dodatkowych zależności do testów
RUN dnf install -y \
    perl-Test-Harness \
    perl-Test-Simple \
    cpanminus \
    && dnf clean all

# Instalacja modułów Perl do testów
RUN cpanm Test::More Test::Deep

# Ustawienie katalogu roboczego
WORKDIR /src/irssi

# Uruchomienie testów (użyj jednej z tych opcji)
CMD ["meson", "test", "-C", "Build", "--print-errorlogs"]
# LUB dla bardziej szczegółowego outputu:
# CMD ["sh", "-c", "meson test -C Build --verbose || cat Build/meson-logs/testlog.txt"]