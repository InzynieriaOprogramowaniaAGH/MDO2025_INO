
# Generated by Anaconda 42.27.12
# Generated by pykickstart v3.62
#version=DEVEL

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-42&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f42&arch=x86_64

network --hostname=fedora-nienadzorowana --bootproto=dhcp

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'

# System language
lang pl_PL.UTF-8

timezone Europe/Warsaw --utc
ignoredisk --only-use=sda
clearpart --all --initlabel
autopart --type=lvm
bootloader --location=mbr --boot-drive=sda
firstboot --enable

# Root password
rootpw --iscrypted $y$j9T$narFjE/6C3ovO7bx/cZhEmKR$OW/pUJvHNWRiMTXd5pNGugqlrCgpfEXKXM.GDwNmoj4

%packages
@^server-product-environment
@core
@container-management
wget
curl
unzip
nodejs
%end

%post
# Tworzenie katalogu na aplikację
mkdir -p /usr/local/bin/nodejs-dummy

# Pobranie i wypakowanie artefaktu z GitHuba
wget -O /tmp/node-js-dummy-test.zip https://github.com/InzynieriaOprogramowaniaAGH/MDO2025_INO/raw/refs/heads/AO417742/ITE/GCL06/AO417742/node-js-dummy-test.zip

unzip /tmp/node-js-dummy-test.zip -d /usr/local/bin/nodejs-dummy

# Skrypt startowy aplikacji Node.js
cat << 'EOF' > /usr/local/bin/start-nodejs
#!/bin/bash
cd /usr/local/bin/nodejs-dummy
npm install
npm start
EOF

chmod +x /usr/local/bin/start-nodejs

# Konfiguracja usługi systemd
cat << 'EOF' > /etc/systemd/system/nodejs-dummy.service
[Unit]
Description=Start Node.js Dummy App
After=network.target

[Service]
ExecStart=/usr/local/bin/start-nodejs
Restart=always
User=root

[Install]
WantedBy=multi-user.target
EOF

# Włączenie usługi przy starcie
systemctl enable nodejs-dummy.service

# Włączenie Dockera (bez startu)
systemctl enable docker
%end

# auto reboot 
reboot
