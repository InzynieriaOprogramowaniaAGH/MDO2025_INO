# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Use text mode install
text

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate --hostname=redis-server

# Use network installation
url --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=updates --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

%packages
@^server-product-environment
docker
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all --initlabel

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$y5sophO4VORcfGfiRU7.Jjqw$lTggUDWB8yW.I4AMyBR6jYdi/I0zFSmdfPuYFcY7w03
user --groups=wheel --name=Maciej --password=$y$j9T$qr2UpYPCIOfk1Vt0oXHfswxN$PEG.wJdYEry4ugX.0mxX.L54/5Dk/OC9Dyt8NrJPMVA --iscrypted --gecos="Maciej Przysiezniak"

# Reboot after installation
reboot --eject

%post
# Enable Docker
systemctl enable docker

# Create service to run Redis container
cat > /etc/systemd/system/redis-container.service << 'EOF'
[Unit]
Description=Redis Container
After=docker.service
Requires=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStartPre=/usr/bin/docker pull skoczeka8/redisdeploy:v8
ExecStart=/usr/bin/docker run -d --name redis-deploy -p 6379:6379 skoczeka8/redisdeploy:v8

[Install]
WantedBy=multi-user.target
EOF

# Enable Redis service
systemctl enable redis-container.service
%end