# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Źródło instalacji i repozytoria
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name="updates" --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

# Klawiatura i język
keyboard --vckeymap=pl --xlayouts='pl'
lang pl_PL.UTF-8

# Nazwa hosta
network --hostname=fedora41-host

# Strefa czasowa
timezone Europe/Warsaw --utc

# Partycjonowanie
ignoredisk --only-use=sda
autopart
clearpart --all --initlabel

# Użytkownicy
rootpw --iscrypted --allow-ssh $y$j9T$PPvWXQ08ubuDtlePbgWRwHG5$UX6gS9fKxntSXnmME.7GPO5pGZYkT8o9aBV9okODfhD
user --groups=wheel --name=rusekdawid --password=$y$j9T$isy1wV.oQTw96wiKPjIQi2IE$ooeiaPW.QOSsay.YmAMO1.Ws9vy1YoaSsH3TPNjf9m0 --iscrypted --gecos="rusekdawid"

# Ustawienia po instalacji
firstboot --enable
reboot

# Pakiety do zainstalowania
%packages
@^server-product-environment
wget
curl
docker
%end

# Konfiguracja po instalacji
%post --log=/root/ks-post.log

# Włączenie Dockera
systemctl enable docker.service

# Skrypt uruchamiający Twój program w kontenerze
cat << 'EOF' > /usr/local/sbin/run-my-app-container.sh
#!/bin/bash
IMAGE="rusekdawid/mojprogram:latest"
CONTAINER="mojprogram"
sleep 5
docker pull $IMAGE
docker run -d --name $CONTAINER --restart=unless-stopped -p 3000:3000 $IMAGE
EOF

chmod +x /usr/local/sbin/run-my-app-container.sh

# Usługa systemd do automatycznego uruchomienia programu
cat << 'EOF' > /etc/systemd/system/run-my-app-container.service
[Unit]
Description=Run my Node.js app container
Requires=docker.service
After=network-online.target docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/local/sbin/run-my-app-container.sh

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable run-my-app-container.service

%end
