#version=DEVEL
# Generated by Anaconda 41.35
# Generated by pykickstart v3.58

keyboard --vckeymap=us --xlayouts='us'
lang en_US.UTF-8

url --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

ignoredisk --only-use=sda
autopart
clearpart --all

timezone Europe/Warsaw --utc
network --hostname=hypervdevops

user --groups=wheel --name=kpudzisz --password=$y$j9T$DKxnZJ7WP4l6MKdLkYRLXCRl$wVlD8HK6INb0EG4043ZKkXT9tYj6j4W0AQjsuMxtIhA --iscrypted --gecos="Kamil Pudzisz"
rootpw --lock

firstboot --enable
reboot

%packages
@^custom-environment
wget
curl
docker
%end

%post --log=/root/post-install.log --interpreter=/bin/bash

echo "==> Enabling and starting Docker service..."
systemctl enable docker
systemctl start docker

echo "==> Pulling Docker image from Docker Hub..."
/usr/bin/docker pull kamilpudzisz/nody-dummy-test:latest

echo "==> Creating systemd service to auto-start container..."

cat <<EOF > /etc/systemd/system/myapp.service
[Unit]
Description=NodeDummyApp Docker Container
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm -p 80:80 --name myapp white67/node-dummy-deploy:latest
ExecStop=/usr/bin/docker stop myapp

[Install]
WantedBy=multi-user.target
EOF

echo "==> Enabling MyApp service..."
systemctl enable myapp.service

echo "==> Post-installation complete."
%end