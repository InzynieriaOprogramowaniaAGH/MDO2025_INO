Started by user admin
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/lab6
[Pipeline] {
[Pipeline] sh
+ date +%Y.%m.%d-%H%M%S
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Prepare Environment)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ docker rm -f deploy-container test-container
deploy-container
Error response from daemon: No such container: test-container
+ docker rmi nodebuild nodetest deploy
Untagged: nodebuild:latest
Deleted: sha256:2fe72b21a6b21867ca1b8d1501936083839c3a6e0970319311b351bafa26f294
Untagged: nodetest:latest
Deleted: sha256:58efae9a3132ad3b68871d432ad641d5f5e2a962841b800ea1ebbe523b5977e7
Untagged: deploy:latest
+ docker network create ci-network
Error response from daemon: network with name ci-network already exists
+ true
+ rm -f dummy-node-project-2025.04.24-193919.tar.gz
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Clone repo)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ [ -d MDO2025_INO ]
+ rm -rf MDO2025_INO
+ git clone https://github.com/InzynieriaOprogramowaniaAGH/MDO2025_INO
Cloning into 'MDO2025_INO'...
[Pipeline] dir
Running in /var/jenkins_home/workspace/lab6/MDO2025_INO
[Pipeline] {
[Pipeline] sh
+ git checkout KP415903
Switched to a new branch 'KP415903'
branch 'KP415903' set up to track 'origin/KP415903'.
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build "build image")
[Pipeline] script
[Pipeline] {
[Pipeline] dir
Running in /var/jenkins_home/workspace/lab6/MDO2025_INO/ITE/GCL06/KP415903/Sprawozdanie1/Lab3 dockerfiles
[Pipeline] {
[Pipeline] sh
+ docker build -t nodebuild -f Dockerfile.nodebuild .
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.nodebuild
#1 transferring dockerfile: 234B done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/node:latest
#2 DONE 0.9s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/4] FROM docker.io/library/node:latest@sha256:c5bfe90b30e795ec57bcc0040065ca6f284af84a1dafd22a207bd6b48c39ce01
#4 DONE 0.0s

#5 [2/4] WORKDIR /app
#5 CACHED

#6 [3/4] RUN git clone https://github.com/devenes/node-js-dummy-test .
#6 CACHED

#7 [4/4] RUN npm install
#7 CACHED

#8 exporting to image
#8 exporting layers done
#8 writing image sha256:2fe72b21a6b21867ca1b8d1501936083839c3a6e0970319311b351bafa26f294 done
#8 naming to docker.io/library/nodebuild done
#8 DONE 0.0s
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build "test image")
[Pipeline] script
[Pipeline] {
[Pipeline] dir
Running in /var/jenkins_home/workspace/lab6/MDO2025_INO/ITE/GCL06/KP415903/Sprawozdanie1/Lab3 dockerfiles
[Pipeline] {
[Pipeline] sh
+ docker build -t nodetest -f Dockerfile.nodetest .
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.nodetest
#1 transferring dockerfile: 144B done
#1 DONE 0.1s

#2 [internal] load metadata for docker.io/library/nodebuild:latest
#2 DONE 0.0s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/1] FROM docker.io/library/nodebuild:latest
#4 CACHED

#5 exporting to image
#5 exporting layers done
#5 writing image sha256:58efae9a3132ad3b68871d432ad641d5f5e2a962841b800ea1ebbe523b5977e7 done
#5 naming to docker.io/library/nodetest done
#5 DONE 0.0s
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Run Tests)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ docker network create ci-network
Error response from daemon: network with name ci-network already exists
+ true
+ docker run --rm --network ci-network --name test-container nodetest

> dummy-nodejs-todo@0.1.1 test
> jest src/index.test.js

PASS src/index.test.js
  GET /
    âœ“ should return 200 OK (23 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        0.395 s
Ran all test suites matching /src\/index.test.js/i.
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Deploy Image)
[Pipeline] script
[Pipeline] {
[Pipeline] dir
Running in /var/jenkins_home/workspace/lab6/MDO2025_INO/ITE/GCL06/KP415903/Sprawozdanie2
[Pipeline] {
[Pipeline] sh
+ docker build -t deploy -f Dockerfile.deploy .
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.deploy
#1 transferring dockerfile: 362B done
#1 DONE 0.1s

#2 [internal] load metadata for docker.io/library/nodebuild:latest
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/node:slim
#3 DONE 0.2s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [stage-0 1/6] FROM docker.io/library/node:slim@sha256:dfb18d8011c0b3a112214a32e772d9c6752131ffee512e974e59367e46fcee52
#5 DONE 0.0s

#6 FROM docker.io/library/nodebuild:latest
#6 DONE 0.0s

#7 [stage-0 5/6] COPY --from=nodebuild /app/src /app/src
#7 CACHED

#8 [stage-0 3/6] COPY --from=nodebuild /app/node_modules /app/node_modules
#8 CACHED

#9 [stage-0 4/6] COPY --from=nodebuild /app/package*.json /app/
#9 CACHED

#10 [stage-0 2/6] WORKDIR /app
#10 CACHED

#11 [stage-0 6/6] COPY --from=nodebuild /app/public /app/public
#11 CACHED

#12 exporting to image
#12 exporting layers done
#12 writing image sha256:d7e9f8be253a2c72ec3969924c95f482092f5d0e450d86c6f9142d353a671b83 done
#12 naming to docker.io/library/deploy done
#12 DONE 0.0s
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy Application)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ docker stop deploy-container
Error response from daemon: No such container: deploy-container
+ true
+ docker rm deploy-container
Error response from daemon: No such container: deploy-container
+ true
+ docker run -d --network ci-network --name deploy-container deploy
ae5bba9f15f6bfaa6f02cbe7150aad5a93cf52bbf5ef1b0e2e919d7c43d61a3f
+ sleep 5
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Curl Test)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ docker run --rm --network ci-network curlimages/curl curl deploy-container:3000
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100  1074  100  1074    0     0   119k      0 --:--:-- --:--:-- --:--:--  131k
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Error</title>
</head>
<body>
<pre>Error: Failed to lookup view &quot;index&quot; in views directory &quot;/app/views&quot;<br> &nbsp; &nbsp;at Function.render (/app/node_modules/express/lib/application.js:597:17)<br> &nbsp; &nbsp;at ServerResponse.render (/app/node_modules/express/lib/response.js:1039:7)<br> &nbsp; &nbsp;at /app/src/index.js:48:9<br> &nbsp; &nbsp;at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)<br> &nbsp; &nbsp;at next (/app/node_modules/express/lib/router/route.js:144:13)<br> &nbsp; &nbsp;at Route.dispatch (/app/node_modules/express/lib/router/route.js:114:3)<br> &nbsp; &nbsp;at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5)<br> &nbsp; &nbsp;at /app/node_modules/express/lib/router/index.js:286:22<br> &nbsp; &nbsp;at Function.process_params (/app/node_modules/express/lib/router/index.js:348:12)<br> &nbsp; &nbsp;at next (/app/node_modules/express/lib/router/index.js:280:10)</pre>
</body>
</html>
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Publish)
[Pipeline] script
[Pipeline] {
[Pipeline] dir
Running in /var/jenkins_home/workspace/lab6/MDO2025_INO/ITE/GCL06/KP415903/Sprawozdanie2
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $NPM_TOKEN
[Pipeline] {
[Pipeline] sh
Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
		 Affected argument(s) used the following variable(s): [NPM_TOKEN]
		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
+ docker build -f Dockerfile.publish --build-arg NPM_TOKEN=**** --build-arg APP_VERSION=2025.04.24-194909 -t npmpublish .
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.publish
#1 transferring dockerfile: 748B done
#1 DONE 0.1s

#2 [internal] load metadata for docker.io/library/nodebuild:latest
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/node:18-slim
#3 DONE 0.2s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [stage-0 1/9] FROM docker.io/library/node:18-slim@sha256:39095e997ff4399e1b07c147ccb432f47bd9e67c639d5fdf41af4a796c50ecf7
#5 DONE 0.0s

#6 FROM docker.io/library/nodebuild:latest
#6 DONE 0.0s

#7 [internal] load build context
#7 transferring context: 480.03kB 0.0s done
#7 DONE 0.1s

#8 [stage-0 2/9] WORKDIR /app
#8 CACHED

#9 [stage-0 3/9] COPY --from=nodebuild /app/package*.json /app/
#9 CACHED

#10 [stage-0 4/9] COPY . .
#10 DONE 0.2s

#11 [stage-0 5/9] RUN npm install
#11 4.850 
#11 4.850 added 354 packages, and audited 355 packages in 4s
#11 4.850 
#11 4.850 37 packages are looking for funding
#11 4.851   run `npm fund` for details
#11 4.861 
#11 4.861 17 vulnerabilities (3 low, 3 moderate, 9 high, 2 critical)
#11 4.861 
#11 4.861 To address issues that do not require attention, run:
#11 4.861   npm audit fix
#11 4.861 
#11 4.861 To address all issues (including breaking changes), run:
#11 4.861   npm audit fix --force
#11 4.861 
#11 4.861 Run `npm audit` for details.
#11 4.862 npm notice
#11 4.862 npm notice New major version of npm available! 10.8.2 -> 11.3.0
#11 4.862 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.3.0
#11 4.862 npm notice To update run: npm install -g npm@11.3.0
#11 4.862 npm notice
#11 DONE 5.1s

#12 [stage-0 6/9] RUN echo "Updating to version: 2025.04.24-194909" &&     npm version 2025.04.24-194909 --no-git-tag-version &&     sed -i 's/"name": "dummy-nodejs-todo"/"name": "@white67\/dummy-node-project"/' package.json
#12 0.306 Updating to version: 2025.04.24-194909
#12 0.469 v2025.4.24-194909
#12 DONE 0.6s

#13 [stage-0 7/9] RUN echo "//registry.npmjs.org/:_authToken=****" > .npmrc &&     echo "//registry.npmjs.org/:always-auth=true" >> .npmrc &&     echo "registry=https://registry.npmjs.org/" >> .npmrc
#13 DONE 0.4s

#14 [stage-0 8/9] RUN npm publish --access public
#14 0.890 npm notice
#14 0.890 npm notice package: @white67/dummy-node-project@2025.4.24-194909
#14 0.890 npm notice Tarball Contents
#14 0.891 npm notice 757B Dockerfile
#14 0.891 npm notice 253B Dockerfile.deploy
#14 0.891 npm notice 638B Dockerfile.publish
#14 0.891 npm notice 4.2kB Jenkinsfile
#14 0.891 npm notice 3.2kB Jenkinsfile.old
#14 0.891 npm notice 3.7kB README.md
#14 0.891 npm notice 952B bash_history
#14 0.891 npm notice 453B package.json
#14 0.891 npm notice 4.4kB ss/5/1-create-jenkins.png
#14 0.891 npm notice 14.1kB ss/5/2-run-dind.png
#14 0.891 npm notice 121.8kB ss/5/3-build-jenkins.png
#14 0.891 npm notice 15.3kB ss/5/4-run-jenkins.png
#14 0.891 npm notice 7.1kB ss/5/5-forward-port.png
#14 0.891 npm notice 49.2kB ss/5/6-new-project-logs.png
#14 0.891 npm notice 11.1kB ss/5/7-new-project-success.png
#14 0.891 npm notice 56.3kB ss/5/8-pipeline-logs-1.png
#14 0.891 npm notice 57.1kB ss/5/9-pipeline-logs-2.png
#14 0.891 npm notice 62.2kB ss/5/10-pipeline-logs-3.png
#14 0.891 npm notice 59.8kB ss/5/11-pipeline-logs-4.png
#14 0.891 npm notice 5.6kB ss/5/12-pipeline-success.png
#14 0.891 npm notice Tarball Details
#14 0.891 npm notice name: @white67/dummy-node-project
#14 0.891 npm notice version: 2025.4.24-194909
#14 0.891 npm notice filename: white67-dummy-node-project-2025.4.24-194909.tgz
#14 0.891 npm notice package size: 406.9 kB
#14 0.891 npm notice unpacked size: 478.1 kB
#14 0.891 npm notice shasum: 61ce29b72be068d0a4ad373125141b91f65a9dd3
#14 0.891 npm notice integrity: sha512-4MIdi9a9RlsAI[...]HgES+QSh0zRgA==
#14 0.891 npm notice total files: 20
#14 0.892 npm notice
#14 0.893 npm notice Publishing to https://registry.npmjs.org/ with tag latest and public access
#14 3.350 + @white67/dummy-node-project@2025.4.24-194909
#14 DONE 3.5s

#15 [stage-0 9/9] RUN rm -f ~/.npmrc
#15 DONE 0.4s

#16 exporting to image
#16 exporting layers
#16 exporting layers 1.2s done
#16 writing image sha256:5cb221343326692df427369498b16d1f2b286530c3fa454607c487c42756eebb done
#16 naming to docker.io/library/npmpublish done
#16 DONE 1.2s

 [33m1 warning found (use docker --debug to expand):
[0m - SecretsUsedInArgOrEnv: Do not use ARG or ENV instructions for sensitive data (ARG "NPM_TOKEN") (line 16)
+ docker run --rm -e NPM_TOKEN=**** npmpublish
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ docker save deploy
+ gzip
[Pipeline] archiveArtifacts
Archiving artifacts
Recording fingerprints
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
