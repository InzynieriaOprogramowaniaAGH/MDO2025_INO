- name: Ensure Docker is installed
  package:
    name:
      - docker
    state: present

- name: Ensure Docker service is running
  service:
    name: docker
    state: started
    enabled: true

- name: Pull published Docker image from Docker Hub
  community.docker.docker_image:
    name: bskubel/curl-final
    tag: latest
    source: pull

- name: Run curl-final container
  community.docker.docker_container:
    name: curl-final
    image: bskubel/curl-final:latest
    state: started
    restart_policy: unless-stopped
    command: tail -f /dev/null

- name: Wait for container to initialize
  pause:
    seconds: 5

- name: Test connectivity from container
  command: docker exec curl-final curl -s --fail http://www.metal.agh.edu.pl
  register: curl_test
  ignore_errors: yes

- name: Show result of connectivity test
  debug:
    msg: "Result: {{ curl_test.stdout if curl_test.rc == 0 else 'Connection failed!' }}"

- name: Stop the container
  community.docker.docker_container:
    name: curl-final
    state: stopped

- name: Remove the container
  community.docker.docker_container:
    name: curl-final
    state: absent
