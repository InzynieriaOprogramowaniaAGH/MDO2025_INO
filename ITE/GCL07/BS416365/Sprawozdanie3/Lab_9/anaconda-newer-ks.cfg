#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

# Network information
network  --bootproto=dhcp --device=eth0 --ipv6=auto --activate --hostname=host-p-odpowiedzi-post

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64
repo --name=docker-ce-stable --baseurl=https://download.docker.com/linux/fedora/41/x86_64/stable

%packages
@^custom-environment
docker-ce
docker-ce-cli
containerd.io
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all --initlabel

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$a246fi5kT/yRXtgXckttNu36$0N4D6CHberfYfkxFU1jCufUWbFkmrsxCAPH..l7Y.R4

%post
# Włączenie usługi Docker przy starcie systemu
systemctl enable docker

# Pobranie obrazu Dockera
/usr/bin/docker pull bskubel/curl-final:latest || true

# Utworzenie jednostki systemd do uruchamiania kontenera
cat > /etc/systemd/system/mycontainer.service <<EOF
[Unit]
Description=Start Docker container
Requires=docker.service network-online.target
After=docker.service network-online.target

[Service]
Restart=always
ExecStartPre=-/usr/bin/docker rm -f deploy
ExecStart=/usr/bin/docker run -dit --name deploy -p 3000:3000 bskubel/curl-final:latest
ExecStop=/usr/bin/docker stop deploy

[Install]
WantedBy=multi-user.target
EOF

# Włączenie kontenera przy starcie systemu
systemctl enable mycontainer.service
%end

# Automatyczny restart po instalacji systemu
reboot