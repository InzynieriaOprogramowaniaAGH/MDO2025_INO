# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=gb --xlayouts='gb'
# System language
lang en_GB.UTF-8 --addsupport=en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

%packages
@^custom-environment

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.11.0
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone Europe/Warsaw --utc

#Root password
rootpw --lock
user --groups=wheel --name=kstarzec --password=$y$j9T$m00KAZsQBljCtxk/gFRuj.xF$9g8.QGqnCJfoE8zqnENdTXha63AD8RYUA8NM18W0V1D --iscrypted --gecos="Karolina Starzec"

# Pakiety
%packages
@^server-product-environment
docker
wget
%end

# Konfiguracja po instalacji
%post
echo "Pobieram i uruchamiam kontener aplikacji"
systemctl enable docker

# Pobranie i uruchomienie kontenera po pierwszym uruchomieniu
cat > /etc/systemd/system/node-app.service <<EOF
[Unit]
Description=Start Node.js To-Do App
After=docker.service
Requires=docker.service

[Service]
ExecStart=/usr/bin/docker run --rm -p 3000:3000 kstarzec/node_deploy:v2
Restart=always

[Install]
WantedBy=multi-user.target
EOF

systemctl enable node-app
%end

# Autoreboot
reboot