- name: Run cJSON application container
  docker_container:
    name: cjson-app-test
    image: "cjson-app:{{ cjson_version }}"
    state: started
    detach: no
    auto_remove: no  # pozwala później sprawdzić status i logi
  register: app_output

- name: Get container info after run
  docker_container_info:
    name: cjson-app-test
  register: container_info

- name: Display application output
  command: docker logs cjson-app-test
  register: app_logs

- name: Show logs
  debug:
    msg: "{{ app_logs.stdout_lines }}"

- name: Verify application ran successfully
  assert:
    that:
      - container_info.container.State.ExitCode == 0
    fail_msg: "cJSON application failed to run properly"
    success_msg: "cJSON application executed successfully"

- name: Clean up test container
  docker_container:
    name: cjson-app-test
    state: absent
  ignore_errors: yes