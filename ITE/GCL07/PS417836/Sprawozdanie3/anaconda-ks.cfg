# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL

keyboard --vckeymap=pl --xlayouts='pl'
lang pl_PL.UTF-8

network --bootproto=dhcp --device=eth0 --ipv6=auto --activate --hostname=host-p-odpowiedzi

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-41&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f41&arch=x86_64

ignoredisk --only-use=sda
clearpart --all --initlabel
autopart

timezone Europe/Warsaw --utc

rootpw --iscrypted --allow-ssh $y$j9T$EdlH0qTbCbkj9gMAkuj5uRDm$IiKbwuXZzs4aMwX82qfx4BsD3c0HCTeK0YOtfNw8wy0
user --groups=wheel --name=psocala --password=$y$j9T$DKKrBZ/DTxGfL3nY47qmyLG9$4SuT5/d/Fnol7AFh/LhKFTwQW7fVMY.bII6hFc6YK57 --iscrypted --gecos="Paweł Socała"

# Pakiety systemowe + dependencje programu
%packages
@^custom-environment
ncurses-compat-libs
binutils
tar
wget
%end

firstboot --enable

# Instalacja programu z .deb
%post
set -x

# Tworzenie katalogu tymczasowego
mkdir -p /tmp/irssi-deb
cd /tmp/irssi-deb

# Pobieranie pakietu .deb z mojego serwera Jenkins
wget http://192.168.0.25:8080/job/irssi_pipeline_v2/lastSuccessfulBuild/artifact/irssi_6.0.0-1_amd64.deb -O irssi.deb

# Rozpakowywanie .deb
ar x irssi.deb

# Sprawdzenie, które pliki data.tar mają - może być .gz, .xz lub .zst
ls -l data.tar.*

# Rozpakowanie data.tar.*
tar -xf data.tar.*

# Diagnostyka zawartości po rozpakowaniu
ls -l
ls -l usr/bin

# Kopiowanie binariów do odpowiednich katalogów z zachowaniem atrybutów
cp -a usr/* /usr/

# Autostart przez dodanie do .bash_profile
mkdir -p /home/psocala
echo '/usr/bin/irssi' >> /home/psocala/.bash_profile
chown psocala:psocala /home/psocala/.bash_profile

# (Opcjonalnie) czyszczenie
rm -rf /tmp/irssi-deb

%end

# Automatyczny restart po instalacji
reboot