# Generated by Anaconda 41.35
# Generated by pykickstart v3.58
#version=DEVEL
text

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang pl_PL.UTF-8

#zmiana hostname
network --bootproto=dhcp --device=eth0 --onboot=on --hostname=szymon

#partycjonowannie
ignoredisk --only-use=sda
clearpart --all --initlabel --drives=sda
autopart --type=lvm


bootloader --location=mbr --boot-drive=sda

timezone Europe/Warsaw --utc


# Root password
rootpw --iscrypted $y$j9T$xhKzK0c1vGm593WENUOP6niB$b2bORTZQi/F6hbjKBx6rdlr8blGj4n5aWC5/j7EksV5
user --groups=wheel --name=user --password=$y$j9T$IVATL/NZgLT7n4ukZPDoMLqP$9D2debDHBmbq1nqIsvB.QedZykAY7x7P1YKGc.ILVZD --iscrypted --gecos="szymon"

skipx
firstboot --enable
reboot

%packages
@^custom-environment
docker
wget
tar
git
%end


%post --log=/root/ks-post.log --interpreter /usr/bin/bash -x

systemctl enable docker.service


URL="https://raw.githubusercontent.com/copperhead143/AGH-Node-Calculator-DevOps/main/calculator-app-1.0.0.tgz"
wget -O /tmp/myapp.tgz "$URL"


mkdir -p /usr/local/bin
tar -xzf /tmp/myapp.tgz -C /usr/local/bin
chmod +x /usr/local/bin/myapp


cat > /etc/systemd/system/myapp.service << 'EOF'
[Unit]
Description=MyApp Service
After=network.target docker.service

[Service]
Type=simple
ExecStart=/usr/local/bin/myapp
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

systemctl enable myapp.service


cat /root/ks-post.log > /dev/tty1
%end
