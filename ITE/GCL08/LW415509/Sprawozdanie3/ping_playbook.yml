---
- name: Ping all machines
  hosts: all
  gather_facts: no

  tasks:
    - name: Ping (pierwsze podej≈õcie)
      ansible.builtin.ping:


- name: Copy inventory file to endpoints
  hosts: endpoints
  gather_facts: no

  tasks:
    - name: Copy inventory.ini to remote endpoints
      ansible.builtin.copy:
        src: inventory.ini
        dest: /home/{{ ansible_user }}/inventory.ini
        mode: '0644'


- name: Ping all machines again for comparison
  hosts: all
  gather_facts: no

  tasks:
    - name: Ping - second time
      ansible.builtin.ping:


- name: Upgrade system packages
  hosts: endpoints
  remote_user: ansible

  tasks:
    - name: Upgrade all packages
      ansible.builtin.dnf:
        name: '*'
        state: latest
      become: true


- name: Restart critical services
  hosts: endpoints
  become: yes

  tasks:
    - name: Restart sshd
      ansible.builtin.service:
        name: sshd
        state: restarted

    - name: Restart rngd
      ansible.builtin.service:
        name: rngd
        state: restarted
      ignore_errors: yes