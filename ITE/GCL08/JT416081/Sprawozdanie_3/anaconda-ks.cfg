# Generated by Anaconda 41.35
#version=DEVEL

keyboard --vckeymap=us --xlayouts='us'
lang en_US.UTF-8
timezone Europe/Warsaw --utc
rootpw --lock
user --groups=wheel --name=jakub --password=$y$j9T$I6s3wKK62BwkaIO0o2RjfMBN$hR7PFNmvVQP1Bj6/N2vww6JWXedsg1sodywI81u89p. --iscrypted --gecos="Jakub"

ignoredisk --only-use=sda
autopart
clearpart --none --initlabel

firstboot --enable

%packages
@^custom-environment
wget
curl
docker
%end

%post --log=/root/post-install.log

# Włącz Docker po starcie systemu
systemctl enable docker

# Utwórz jednostkę systemd uruchamiającą kontener po starcie systemu
cat > /etc/systemd/system/cjson-deploy.service <<EOF
[Unit]
Description=Run cjson-deploy container
After=network.target docker.service
Requires=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run --rm jaktyl/cjson-deploy
ExecStop=/usr/bin/docker stop cjson-deploy

[Install]
WantedBy=multi-user.target
EOF

# Włącz usługę
systemctl enable cjson-deploy.service

%end