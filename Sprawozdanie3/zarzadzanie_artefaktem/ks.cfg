url --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-42&arch=x86_64
repo --name=updates --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f42&arch=x86_64

lang en_US.UTF-8
keyboard us
timezone Europe/Warsaw --isUtc
rootpw --plaintext fedora123

clearpart --all --initlabel
autopart

auth --useshadow --passalgo=sha512
selinux --enforcing
firewall --enabled
firstboot --disable
network --bootproto=dhcp --hostname=xz-host
bootloader --location=mbr
reboot

%packages
@core
wget
xz
gcc
make
libtool
autoconf
automake
%end

%post --interpreter /bin/bash
wget http://10.0.2.15:8080/xz.tar.gz -O /tmp/xz.tar.gz

mkdir -p /usr/local/bin/xz
tar -xzf /tmp/xz.tar.gz -C /usr/local/bin/xz
chmod +x /usr/local/bin/xz/xz
ln -s /usr/local/bin/xz/xz /usr/local/bin/xz

cat <<EOF > /etc/systemd/system/xz-runner.service
[Unit]
Description=Run XZ Utils on boot
After=network.target

[Service]
ExecStart=/usr/local/bin/xz/xz --version
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

systemctl enable xz-runner.service
%end
